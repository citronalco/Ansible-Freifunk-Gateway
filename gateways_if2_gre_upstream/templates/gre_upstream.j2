# {{ ansible_managed }}

{% if ffi_tun is defined %}
#    _____ _____ ___
#   |  ___|  ___|_ _|
#   | |_  | |_   | |
#   |  _| |  _|  | |
#   |_|   |_|   |___|
#
{% for tun in ffi_tun %}

auto tun-ffi-{{ tun.name }}
iface tun-ffi-{{ tun.name }}
	tunnel-mode ip6gre
	tunnel-endpoint {{ tun.gre6_target }}
	tunnel-local {{ ipv6 }}
	tunnel-ttl 255
	mtu 1400
	vrf ffnet
	address {{ tun.v4_remote | ansible.utils.ipaddr( tun.v4_remote.split('.')[3] | int + 1) | ansible.utils.ipaddr('address') }}/{{ tun.v4_remote | ansible.utils.ipaddr('netmask') }}
	address {{ tun.v6_remote | ansible.utils.next_nth_usable(1) }}/{{ tun.v6_remote | ansible.utils.ipaddr('prefix') }}
{% endfor %}
{% endif %}

{% if ffrl_tun is defined %}
#     _____ _____ ____  _
#    |  ___|  ___|  _ \| |
#    | |_  | |_  | |_) | |
#    |  _| |  _| |  _ <| |___
#    |_|   |_|   |_| \_|_____|
#
{% for tun in ffrl_tun %}

auto tun-ffrl-{{ tun.name }}
iface tun-ffrl-{{ tun.name }}
	tunnel-mode gre
	tunnel-endpoint {{ tun.gre_target }}
	tunnel-local {{ ipv4 }}
	tunnel-ttl 255
	mtu 1400
	vrf ffnet
	address {{ tun.v4_remote | ansible.utils.ipaddr( tun.v4_remote.split('.')[3] | int + 1) | ansible.utils.ipaddr('address') }}/{{ tun.v4_remote | ansible.utils.ipaddr('netmask') }}
	address {{ tun.v6_remote | ansible.utils.next_nth_usable(1) }}/{{ tun.v6_remote | ansible.utils.ipaddr('prefix') }}
{% endfor %}
{% endif %}
